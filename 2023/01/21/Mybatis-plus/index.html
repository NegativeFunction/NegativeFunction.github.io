<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/252/logo.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/252/logo.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/252/logo.png">
  <link rel="mask-icon" href="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/252/logo.png" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"negativefunction.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="MyBatisPlus_Note1. MyBatisPlus概述MyBatisPlus主要用于更简单的解决 CRUD –自动化完成 CRUD 同类型的还有 JPA tk-mapper MyBatisPlus –课后简单了解  MyBatisPlus 简介  MyBatis 的诞生是为了 简化 JDBC 而 MyBatisPlus 的诞生 是为了 简化 MyBatis 所以 人类的本质 是偷懒 官网">
<meta property="og:type" content="article">
<meta property="og:title" content="Mybatis-plus">
<meta property="og:url" content="https://negativefunction.github.io/2023/01/21/Mybatis-plus/index.html">
<meta property="og:site_name" content="Welcome To Lin&#39;s World">
<meta property="og:description" content="MyBatisPlus_Note1. MyBatisPlus概述MyBatisPlus主要用于更简单的解决 CRUD –自动化完成 CRUD 同类型的还有 JPA tk-mapper MyBatisPlus –课后简单了解  MyBatisPlus 简介  MyBatis 的诞生是为了 简化 JDBC 而 MyBatisPlus 的诞生 是为了 简化 MyBatis 所以 人类的本质 是偷懒 官网">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/252/image-20221013201516276.png">
<meta property="og:image" content="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/252/image-20221013201550898.png">
<meta property="og:image" content="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/252/image-20221013201701736.png">
<meta property="og:image" content="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/252/image-20221013110317209.png">
<meta property="article:published_time" content="2023-01-20T23:22:51.000Z">
<meta property="article:modified_time" content="2023-01-20T23:22:53.229Z">
<meta property="article:author" content="Linyuxuan">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/252/image-20221013201516276.png">

<link rel="canonical" href="https://negativefunction.github.io/2023/01/21/Mybatis-plus/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Mybatis-plus | Welcome To Lin's World</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Welcome To Lin's World</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">The Future Will Come</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">17</span></a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://negativefunction.github.io/2023/01/21/Mybatis-plus/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/252/05.jpg">
      <meta itemprop="name" content="Linyuxuan">
      <meta itemprop="description" content="Hope Sometimes Love Brain">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Welcome To Lin's World">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Mybatis-plus
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-01-21 07:22:51 / Modified: 07:22:53" itemprop="dateCreated datePublished" datetime="2023-01-21T07:22:51+08:00">2023-01-21</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="MyBatisPlus-Note"><a href="#MyBatisPlus-Note" class="headerlink" title="MyBatisPlus_Note"></a>MyBatisPlus_Note</h1><h2 id="1-MyBatisPlus概述"><a href="#1-MyBatisPlus概述" class="headerlink" title="1. MyBatisPlus概述"></a>1. MyBatisPlus概述</h2><p>MyBatisPlus主要用于更简单的解决 CRUD –自动化完成 CRUD</p>
<p>同类型的还有 JPA tk-mapper MyBatisPlus –课后简单了解</p>
<blockquote>
<p><strong>MyBatisPlus 简介</strong></p>
</blockquote>
<p>MyBatis 的诞生是为了 简化 JDBC</p>
<p>而 MyBatisPlus 的诞生 是为了 简化 MyBatis</p>
<p>所以 人类的本质 是偷懒</p>
<p>官网：<a target="_blank" rel="noopener" href="https://baomidou.com/">https://baomidou.com/</a></p>
<blockquote>
<p><strong>MyBatisPlus 特性</strong></p>
</blockquote>
<ul>
<li><strong>无侵入</strong>：只做增强不做改变，引入它不会对现有工程产生影响，如丝般顺滑</li>
<li><strong>损耗小</strong>：启动即会自动注入基本 CURD，性能基本无损耗，直接面向对象操作 <strong>使用 <code>BaseMapper&lt;T&gt;</code> 极简了常用 CRUD</strong></li>
<li><strong>强大的 CRUD 操作</strong>：内置通用 Mapper、通用 Service，仅仅通过少量配置即可实现单表大部分 CRUD 操作，更有强大的条件构造器，满足各类使用需求 <strong>简单的 CRUD 将不再需要自己编写</strong></li>
<li><strong>支持 Lambda 形式调用</strong>：通过 Lambda 表达式，方便的编写各类查询条件，无需再担心字段写错</li>
<li><strong>支持主键自动生成</strong>：支持多达 4 种主键策略（<strong>内含分布式唯一 ID 生成器 - Sequence</strong>），可自由配置，完美解决主键问题</li>
<li><strong>支持 ActiveRecord 模式</strong>：支持 ActiveRecord 形式调用，实体类只需继承 Model 类即可进行强大的 CRUD 操作</li>
<li><strong>支持自定义全局通用操作</strong>：支持全局通用方法注入（ Write once, use anywhere ）</li>
<li><strong>内置代码生成器</strong>：采用代码或者 Maven 插件可快速生成 Mapper 、 Model 、 Service 、 Controller 层代码，支持模板引擎，更有超多自定义配置等您来使用 <strong>(自动生成代码 –类似于 EasyCode)</strong></li>
<li><strong>内置分页插件</strong>：基于 <strong>MyBatis 物理分页</strong>，开发者无需关心具体操作，配置好插件之后，写分页等同于普通 List 查询</li>
<li><strong>分页插件支持多种数据库</strong>：支持 MySQL、MariaDB、Oracle、DB2、H2、HSQL、SQLite、Postgre、SQLServer 等多种数据库</li>
<li><strong>内置性能分析插件</strong>：可输出 SQL 语句以及其执行时间，建议开发测试时启用该功能，能快速揪出慢查询</li>
<li><strong>内置全局拦截插件</strong>：提供全表 delete 、 update 操作智能分析阻断，也可自定义拦截规则，预防误操作</li>
</ul>
<p>MyBatisPlus 支持数据库：</p>
<p><em>任何能使用 <code>MyBatis</code> 进行 CRUD, 并且支持标准 SQL 的数据库，具体支持情况如下，如果不在下列表查看分页部分教程 PR 您的支持。</em></p>
<ul>
<li>MySQL，Oracle，DB2，H2，HSQL，SQLite，PostgreSQL，SQLServer，Phoenix，Gauss ，ClickHouse，Sybase，OceanBase，Firebird，Cubrid，Goldilocks，csiidb</li>
<li>达梦数据库，虚谷数据库，人大金仓数据库，南大通用(华库)数据库，南大通用数据库，神通数据库，瀚高数据库</li>
</ul>
<h2 id="2-快速入门"><a href="#2-快速入门" class="headerlink" title="2. 快速入门"></a>2. 快速入门</h2><p>通过官网 MyBatisPlus 的文档自己研究 特性 锻炼学习能力</p>
<p>快速开始网址：<a target="_blank" rel="noopener" href="https://baomidou.com/pages/226c21/#%E5%88%9D%E5%A7%8B%E5%8C%96%E5%B7%A5%E7%A8%8B">https://baomidou.com/pages/226c21/#%E5%88%9D%E5%A7%8B%E5%8C%96%E5%B7%A5%E7%A8%8B</a></p>
<p>使用步骤概述：</p>
<ol>
<li>导入对应依赖</li>
<li>研究依赖如何配置</li>
<li>代码如何编写</li>
<li>提高扩展技术能力</li>
</ol>
<blockquote>
<p><strong>具体实现步骤</strong></p>
</blockquote>
<ol>
<li>创建数据库 <code>mybatis_plus</code> 创建 user 表 并插入 默认数据</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> <span class="keyword">user</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">user</span></span><br><span class="line">(</span><br><span class="line">    id <span class="type">BIGINT</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;主键ID&#x27;</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">30</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">    age <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;年龄&#x27;</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;邮箱&#x27;</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">user</span> (id, name, age, email) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;Jone&#x27;</span>, <span class="number">18</span>, <span class="string">&#x27;test1@baomidou.com&#x27;</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;Jack&#x27;</span>, <span class="number">20</span>, <span class="string">&#x27;test2@baomidou.com&#x27;</span>),</span><br><span class="line">(<span class="number">3</span>, <span class="string">&#x27;Tom&#x27;</span>, <span class="number">28</span>, <span class="string">&#x27;test3@baomidou.com&#x27;</span>),</span><br><span class="line">(<span class="number">4</span>, <span class="string">&#x27;Sandy&#x27;</span>, <span class="number">21</span>, <span class="string">&#x27;test4@baomidou.com&#x27;</span>),</span><br><span class="line">(<span class="number">5</span>, <span class="string">&#x27;Billie&#x27;</span>, <span class="number">24</span>, <span class="string">&#x27;test5@baomidou.com&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 真实开发中 通常必须包含 version(乐观锁) deleted(逻辑删除) gmt_create gmt_modified 字段</span></span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;注意 在真实开发中 通常必须包含 <code>version(乐观锁) deleted(逻辑删除) gmt_create gmt_modified</code> 字段&#x3D;&#x3D;</p>
<ol start="2">
<li>编写项目 初始化项目 SpringBoot 项目</li>
<li>导入相关依赖<ul>
<li>数据库驱动</li>
<li>lombok</li>
<li>mybatis-plus</li>
</ul>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 数据库驱动 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.30<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- lombok --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- mybatis-plus --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- mybatis-plus 是自己开发的 而并非官方的 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;注意 不要同时导入 mybatis 与 mybatis-plus 依赖&#x3D;&#x3D;</p>
<ol start="4">
<li>连接数据库 与 mybatis 相同</li>
</ol>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysql 5 与 mysql 8 驱动不同 com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">123456</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/mybatis_plus?useSSL=false&amp;useUnicode=true&amp;characterEncoding=utf-8</span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># mysql 8 驱动必须使用 com.mysql.cj.jdbc.Driver 同时需要增加时区配置 serverTimezone=GMT%2B8</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>对比学习 操作步骤<ul>
<li>使用 mybatis 操作步骤 创建 pojo -&gt; dao ( 连接 mybatis 配置 mapper.xml 映射文件 ) -&gt; service -&gt; controller</li>
<li>使用 mybatis-plus 操作步骤 创建 pojo -&gt; mapper 接口 -&gt; 直接使用简单 CRUD</li>
</ul>
</li>
</ol>
<p><strong>参考代码</strong></p>
<p>application.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysql 5 与 mysql 8 驱动不相同 com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">123456</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/mybatis_plus?useSSL=false&amp;useUnicode=true&amp;characterEncoding=utf-8</span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># mysql 8 使用驱动 com.mysql.cj.jdbc.Driver 设置时区 serverTimezone=GMT%2B8</span></span><br></pre></td></tr></table></figure>

<p>User</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mybatisplustest.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UserMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mybatisplustest.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.example.mybatisplustest.pojo.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 mybatis-plus 不需要在提供 mapper.xml 映射文件 只需要在 UserMapper 接口上 实现 BaseMapper 接口即可</span></span><br><span class="line"><span class="meta">@Mapper</span> <span class="comment">// 注解表示为一个 Mapper 文件</span></span><br><span class="line"><span class="comment">//@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; &#123;</span><br><span class="line">    <span class="comment">// 此时 所偶 CRUD 操作就已经编写完成</span></span><br><span class="line">    <span class="comment">// 不需要再像 以前一样编写大量的配置文件</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MyBatisPlusTestApplicationTests</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mybatisplustest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.mybatisplustest.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.example.mybatisplustest.pojo.User;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyBatisPlusTestApplicationTests</span> &#123;</span><br><span class="line">    <span class="comment">// 继承了 BaseMapper 可以直接使用 简单的 CRUD 所有方法均来自 父接口</span></span><br><span class="line">    <span class="comment">// 同样 我们也可以编写自己的扩展方法</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 查询所有用户</span></span><br><span class="line">        <span class="comment">// 参数为 Wrapper --条件构造器 不使用 可为 null</span></span><br><span class="line">        List&lt;User&gt; userList = userMapper.selectList(<span class="literal">null</span>);</span><br><span class="line">        userList.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;注意 必须要在 注启动类上配置 扫描 mapper 包下所有 mapper 接口&#x3D;&#x3D;</p>
<p>思考：</p>
<ul>
<li>SQL在哪里编写的</li>
<li>方法在哪里实现的</li>
</ul>
<h2 id="3-配置日志"><a href="#3-配置日志" class="headerlink" title="3. 配置日志"></a>3. 配置日志</h2><p>配置日志 可以查看到 具体执行的 SQL 语句 </p>
<p>当然在项目上线时 需要将 日志 功能全部关闭 因为配置日志会导致损耗性能</p>
<p>配置日志步骤</p>
<p>application.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置 mybatis-plus 日志</span></span><br><span class="line"><span class="attr">mybatis-plus.configuration.log-impl</span>=<span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br></pre></td></tr></table></figure>

<p>测试结果</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Creating a new SqlSession</span><br><span class="line">SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@518ddd3b] was not registered for synchronization because synchronization is not active</span><br><span class="line">JDBC Connection [HikariProxyConnection@1821228886 wrapping com.mysql.cj.jdbc.ConnectionImpl@493b01ef] will not be managed by Spring</span><br><span class="line">==&gt;  Preparing: SELECT id,name,age,email FROM user </span><br><span class="line">==&gt; Parameters: </span><br><span class="line">&lt;==    Columns: id, name, age, email</span><br><span class="line">&lt;==        Row: 1, Jone, 18, test1@baomidou.com</span><br><span class="line">&lt;==        Row: 2, Jack, 20, test2@baomidou.com</span><br><span class="line">&lt;==        Row: 3, Tom, 28, test3@baomidou.com</span><br><span class="line">&lt;==        Row: 4, Sandy, 21, test4@baomidou.com</span><br><span class="line">&lt;==        Row: 5, Billie, 24, test5@baomidou.com</span><br><span class="line">&lt;==      Total: 5</span><br><span class="line">Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@518ddd3b]</span><br><span class="line">User(id=1, name=Jone, age=18, email=test1@baomidou.com)</span><br><span class="line">User(id=2, name=Jack, age=20, email=test2@baomidou.com)</span><br><span class="line">User(id=3, name=Tom, age=28, email=test3@baomidou.com)</span><br><span class="line">User(id=4, name=Sandy, age=21, email=test4@baomidou.com)</span><br><span class="line">User(id=5, name=Billie, age=24, email=test5@baomidou.com)</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;注意 配置完日志后 就可以通过 自动生成的 SQL 学习 SQL 语句 同时 更好的理解 MyBatis-Plus&#x3D;&#x3D;</p>
<h2 id="4-简单-CRUD-操作详解"><a href="#4-简单-CRUD-操作详解" class="headerlink" title="4. 简单 CRUD 操作详解"></a>4. 简单 CRUD 操作详解</h2><blockquote>
<p><strong>Insert</strong></p>
</blockquote>
<p><strong>参考代码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mybatisplustest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.api.Assert;</span><br><span class="line"><span class="keyword">import</span> com.example.mybatisplustest.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.example.mybatisplustest.pojo.User;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyBatisPlusTestApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 继承了 BaseMapper 可以直接使用 简单的 CRUD 所有方法均来自 父接口</span></span><br><span class="line">    <span class="comment">// 同样 我们也可以编写自己的扩展方法</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 查询所有用户</span></span><br><span class="line">        <span class="comment">// 参数为 Wrapper --条件构造器 不使用 可为 null</span></span><br><span class="line">        List&lt;User&gt; userList = userMapper.selectList(<span class="literal">null</span>);</span><br><span class="line"><span class="comment">//        Assert.isTrue();</span></span><br><span class="line">        userList.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试插入</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">TestInsert</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setName(<span class="string">&quot;Line&quot;</span>);</span><br><span class="line">        user.setAge(<span class="number">18</span>);</span><br><span class="line">        user.setEmail(<span class="string">&quot;1031282691@qq.com&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 上述可见没有插入 ID</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        Creating a new SqlSession</span></span><br><span class="line"><span class="comment">        SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@518ddd3b] was not registered for synchronization because synchronization is not active</span></span><br><span class="line"><span class="comment">        JDBC Connection [HikariProxyConnection@1720760826 wrapping com.mysql.cj.jdbc.ConnectionImpl@6c8dbf56] will not be managed by Spring</span></span><br><span class="line"><span class="comment">        ==&gt;  Preparing: INSERT INTO user ( id, name, age, email ) VALUES ( ?, ?, ?, ? )</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        ==&gt; Parameters: 1580171623430950913(Long), Line(String), 18(Integer), 1031282691@qq.com(String)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        &lt;==    Updates: 1</span></span><br><span class="line"><span class="comment">        Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@518ddd3b]</span></span><br><span class="line"><span class="comment">        1</span></span><br><span class="line"><span class="comment">        User(id=1580171623430950913, name=Line, age=18, email=1031282691@qq.com)</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">// 但是从结果可知 mybatis-plus 会自动生成 ID</span></span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">ret</span> <span class="operator">=</span> userMapper.insert(user);</span><br><span class="line">        System.out.println(ret);    <span class="comment">// 打印受影响的行数</span></span><br><span class="line">        System.out.println(user);   <span class="comment">// 自动生成的 ID 会自动回填到 user 对象的属性中</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>思考：</strong></p>
<ul>
<li><strong>MyBatis-Plus 在什么环节 从哪里 自动生成了 ID</strong></li>
<li><strong>数据库插入的 ID 默认值 为全局唯一 ID ( 全局默认 ID 可以通过一些策略来生成 )</strong></li>
</ul>
<p><strong>查阅资料可知 其中主要使用 &#x3D;&#x3D;主键生成策略&#x3D;&#x3D;</strong></p>
<blockquote>
<p><strong>主键生成策略</strong></p>
</blockquote>
<p><strong>使用雪花算法</strong></p>
<p>参考文章：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/haoxinyue/p/5208136.html">https://www.cnblogs.com/haoxinyue/p/5208136.html</a></p>
<p><strong>雪花算法</strong></p>
<p><em>Twitter的snowflake算法</em></p>
<p>snowflake是Twitter开源的分布式ID生成算法，结果是一个long型的ID。其核心思想是：使用41bit作为毫秒数，10bit作为机器的ID（5个bit是数据中心 –分布在不同地区，5个bit的机器ID），12bit作为毫秒内的流水号（意味着每个节点在每毫秒可以产生 4096 个 ID），最后还有一个符号位，永远是0。</p>
<p>具体实现的代码可以参看<a target="_blank" rel="noopener" href="https://github.com/twitter/snowflake%E3%80%82%E9%9B%AA%E8%8A%B1%E7%AE%97%E6%B3%95%E6%94%AF%E6%8C%81%E7%9A%84TPS%E5%8F%AF%E4%BB%A5%E8%BE%BE%E5%88%B0419%E4%B8%87%E5%B7%A6%E5%8F%B3%EF%BC%882^22*1000%EF%BC%89%E3%80%82">https://github.com/twitter/snowflake。雪花算法支持的TPS可以达到419万左右（2^22*1000）。</a></p>
<p>雪花算法在工程实现上有单机版本和分布式版本。单机版本如下，分布式版本可以参看美团leaf算法：<a target="_blank" rel="noopener" href="https://github.com/Meituan-Dianping/Leaf">https://github.com/Meituan-Dianping/Leaf</a></p>
<p><strong>通过雪花算法 可以保证 此 ID 几乎全球唯一 &#x3D;&#x3D;–不人为指定相同的情况下&#x3D;&#x3D;</strong></p>
<p>TODO：探究 <code>@TableId(type = IdType.ID_WORKER)</code> 源码 以及 工作原理 –默认<strong>ID_WORKER</strong> 为全局唯一ID</p>
<p><strong>主键策略</strong></p>
<ul>
<li><strong>ID_WORKER</strong> –默认是<strong>ID_WORKER</strong>策略 -全局唯一 ID 策略<br>使用 需要在实体类相关字段上 添加 <code>@TableId(type = IdType.ID_WORKER)</code></li>
<li><strong>AUTO</strong> –主键自增策略<br>注意 使用主键自增策略 一定要 添加 <code>@TableId(type = IdType.AUTO)</code> &#x3D;&#x3D;并在 数据库 ID主键 上设置 自增属性 否则会报错&#x3D;&#x3D;</li>
<li><strong>NONE</strong> –未设置主键</li>
<li><strong>INPUT</strong> –手动输入</li>
<li><strong>UUID</strong> –全局唯一ID -UUID</li>
<li><strong>ID_WORKER_STR</strong> –ID_WORKER的字符串表示 -一个是数字表示 一个是字符串表示</li>
</ul>
<p><strong>相关源码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by FernFlower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.baomidou.mybatisplus.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">IdType</span> &#123;</span><br><span class="line">    AUTO(<span class="number">0</span>),</span><br><span class="line">    NONE(<span class="number">1</span>),</span><br><span class="line">    INPUT(<span class="number">2</span>),</span><br><span class="line">    ID_WORKER(<span class="number">3</span>),</span><br><span class="line">    UUID(<span class="number">4</span>),</span><br><span class="line">    ID_WORKER_STR(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> key;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">IdType</span><span class="params">(<span class="type">int</span> key)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.key = key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getKey</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.key;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>参考代码</strong></p>
<p>User</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mybatisplustest.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.IdType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="comment">// 对应 数据库 中的主键 (uuid 自增id 雪花算法 redis zookeeper)</span></span><br><span class="line">    <span class="meta">@TableId(type = IdType.ID_WORKER)</span></span><br><span class="line"><span class="comment">//    @TableId(type = IdType.AUTO)</span></span><br><span class="line"><span class="comment">//    @TableId(type = IdType.NONE)</span></span><br><span class="line"><span class="comment">//    @TableId(type = IdType.INPUT) // 一旦手动输入 ID 之后 就必须要自己配置 ID</span></span><br><span class="line"><span class="comment">//    @TableId(type = IdType.UUID)</span></span><br><span class="line"><span class="comment">//    @TableId(type = IdType.ID_WORKER_STR)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<p><strong>Update</strong></p>
</blockquote>
<p><strong>参考代码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdate</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setId(<span class="number">1580171623430950913L</span>);</span><br><span class="line">    user.setName(<span class="string">&quot;李宁&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        日志：</span></span><br><span class="line"><span class="comment">        Creating a new SqlSession</span></span><br><span class="line"><span class="comment">        SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@2d85fb64] was not registered for synchronization because synchronization is not active</span></span><br><span class="line"><span class="comment">        JDBC Connection [HikariProxyConnection@513241240 wrapping com.mysql.cj.jdbc.ConnectionImpl@630390b9] will not be managed by Spring</span></span><br><span class="line"><span class="comment">        ==&gt;  Preparing: UPDATE user SET name=? WHERE id=?</span></span><br><span class="line"><span class="comment">        ==&gt; Parameters: 李宁(String), 1580171623430950913(Long)</span></span><br><span class="line"><span class="comment">        &lt;==    Updates: 1</span></span><br><span class="line"><span class="comment">        Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@2d85fb64]</span></span><br><span class="line"><span class="comment">        1</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    <span class="comment">// 注意 虽然 userMapper.updateById 调用的 updateById 方法 但是 其输入参数 为一个 T 泛型 即你创建的 实体类</span></span><br><span class="line">    <span class="comment">// 根据多次 测试 可以很明显的 看出 mybatis-plus 可以根据 所给对象的参数 通过条件自动拼接动态 sql</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">ret</span> <span class="operator">=</span> userMapper.updateById(user);</span><br><span class="line">    System.out.println(ret);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;注意 所有 SQL  都是 mybatisplus通过内置的算法帮你 动态配置的 可以通过查看日志的 方式 来进行学习&#x3D;&#x3D;</p>
<blockquote>
<p><strong>MyBatis-Plus 属性自动填充</strong></p>
</blockquote>
<p>根据 阿里巴巴 开发手册：所有数据库表 gmt_create gmt_modified 通常所有表上都要配置 且都需要自动化填充数据</p>
<p>由此 创建时间 修改实践 这系列操作 都应该通过自动化来完成 不希望通过开发人员手动更新</p>
<p><strong>自动填充方式</strong></p>
<ul>
<li><p>方式一 数据库级别 <em>由于工作中 通常不会轻易更改数据库 工作中不推荐使用</em> </p>
<ol>
<li><p>在数据库 表中 添加 相对应的表字段 <code>create_time</code> <code>update_time</code></p>
<p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/252/image-20221013201516276.png" alt="image-20221013201516276"></p>
</li>
<li><p>同步实体类 并测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdate</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setId(<span class="number">1580171623430950913L</span>);</span><br><span class="line">    user.setName(<span class="string">&quot;李宁&quot;</span>);</span><br><span class="line">    user.setAge(<span class="number">22</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        日志：</span></span><br><span class="line"><span class="comment">        Creating a new SqlSession</span></span><br><span class="line"><span class="comment">        SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@2d85fb64] was not registered for synchronization because synchronization is not active</span></span><br><span class="line"><span class="comment">        JDBC Connection [HikariProxyConnection@513241240 wrapping com.mysql.cj.jdbc.ConnectionImpl@630390b9] will not be managed by Spring</span></span><br><span class="line"><span class="comment">        ==&gt;  Preparing: UPDATE user SET name=? WHERE id=?</span></span><br><span class="line"><span class="comment">        ==&gt; Parameters: 李宁(String), 1580171623430950913(Long)</span></span><br><span class="line"><span class="comment">        &lt;==    Updates: 1</span></span><br><span class="line"><span class="comment">        Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@2d85fb64]</span></span><br><span class="line"><span class="comment">        1</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    <span class="comment">// 注意 虽然 userMapper.updateById 调用的 updateById 方法 但是 其输入参数 为一个 T 泛型 即你创建的 实体类</span></span><br><span class="line">    <span class="comment">// 根据多次 测试 可以很明显的 看出 mybatis-plus 可以根据 所给对象的参数 通过条件自动拼接动态 sql</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">ret</span> <span class="operator">=</span> userMapper.updateById(user);</span><br><span class="line">    System.out.println(ret);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看测试结果<br><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/252/image-20221013201550898.png" alt="image-20221013201550898"></p>
</li>
</ol>
</li>
</ul>
<p><strong>参考代码</strong></p>
<p>user</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mybatisplustest.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.IdType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="comment">// 对应 数据库 中的主键 (uuid 自增id 雪花算法 redis zookeeper)</span></span><br><span class="line">    <span class="meta">@TableId(type = IdType.ID_WORKER)</span></span><br><span class="line"><span class="comment">//    @TableId(type = IdType.AUTO)</span></span><br><span class="line"><span class="comment">//    @TableId(type = IdType.NONE)</span></span><br><span class="line"><span class="comment">//    @TableId(type = IdType.INPUT) // 一旦手动输入 ID 之后 就必须要自己配置 ID</span></span><br><span class="line"><span class="comment">//    @TableId(type = IdType.UUID)</span></span><br><span class="line"><span class="comment">//    @TableId(type = IdType.ID_WORKER_STR)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="keyword">private</span> Date updateTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li><p>方式二 代码级别</p>
<ol>
<li><p>删除 数据库 的默认值 <code>CURRENT_TIMESTAMP</code> 以及更新操作</p>
</li>
<li><p>在实体类 字段属性上 增加需要的注解<br>User</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mybatisplustest.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.FieldFill;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.IdType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="comment">// 对应 数据库 中的主键 (uuid 自增id 雪花算法 redis zookeeper)</span></span><br><span class="line">    <span class="meta">@TableId(type = IdType.ID_WORKER)</span></span><br><span class="line"><span class="comment">//    @TableId(type = IdType.AUTO)</span></span><br><span class="line"><span class="comment">//    @TableId(type = IdType.NONE)</span></span><br><span class="line"><span class="comment">//    @TableId(type = IdType.INPUT) // 一旦手动输入 ID 之后 就必须要自己配置 ID</span></span><br><span class="line"><span class="comment">//    @TableId(type = IdType.UUID)</span></span><br><span class="line"><span class="comment">//    @TableId(type = IdType.ID_WORKER_STR)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="comment">// 字段添加填充内容</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Date updateTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写 处理器 来处理 字段属性上增加的注解<br>MyMetaObjectHandler</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mybatisplustest.handler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.handlers.MetaObjectHandler;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.reflection.MetaObject;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span>  <span class="comment">// 添加日志打印</span></span><br><span class="line"><span class="meta">@Component</span>  <span class="comment">// 不要忘记将 处理器 托管到 IOC 容器中</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMetaObjectHandler</span> <span class="keyword">implements</span> <span class="title class_">MetaObjectHandler</span> &#123;</span><br><span class="line">    <span class="comment">// 插入时的 填充策略</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;start insert fill....&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 面向源码学习</span></span><br><span class="line">        <span class="comment">// setFieldValByName(String fieldName, Object fieldVal, MetaObject metaObject) &#123;&#125;</span></span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;createTime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), metaObject);</span><br><span class="line">        <span class="comment">// 插入 数据 时 也需要将更新时间填充</span></span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;updateTime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), metaObject);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新时的 填充策略</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;start update fill....&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;updateTime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), metaObject);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试 插入 与 更新</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAutoFill</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setId(<span class="number">1580171623430950914L</span>);</span><br><span class="line">    user.setName(<span class="string">&quot;Adidas&quot;</span>);</span><br><span class="line">    user.setAge(<span class="number">24</span>);</span><br><span class="line">    user.setEmail(<span class="string">&quot;888777999@126.com&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//        int ret = userMapper.insert(user);</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">ret</span> <span class="operator">=</span> userMapper.updateById(user);</span><br><span class="line">    System.out.println(ret);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
<blockquote>
<p><strong>Insert or Update 乐观锁与悲观锁问题详解</strong></p>
</blockquote>
<p><strong>乐观锁：</strong>处理数据 处理问题十分乐观 认为执行逻辑不会出错 所以做任何操作都不去上锁 如果出现了问题 就再次更新值测试</p>
<p><strong>悲观锁：</strong>处理数据 处理问题十分悲观 认为执行逻辑总会出错 所以做任何操作都先去上锁 再执行操作</p>
<p>主要涉及字段： version、 new version</p>
<p><strong>乐观锁机制详解</strong></p>
<p>乐观锁实现方式：</p>
<ul>
<li>取出记录时，获取当前 version</li>
<li>更新时，带上这个 version</li>
<li>执行更新时， set version &#x3D; newVersion where version &#x3D; oldVersion</li>
<li>如果 version 不对，就更新失败</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 实验案例</span></span><br><span class="line"><span class="comment">-- 乐观锁 先查询 获得版本号 version = 1</span></span><br><span class="line"><span class="comment">-- A线程启动</span></span><br><span class="line"><span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> name <span class="operator">=</span> &quot;kuangshen&quot;, version <span class="operator">=</span> version <span class="operator">+</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">where</span> id <span class="operator">=</span> <span class="number">2</span> <span class="keyword">and</span> version <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- B线程 抢先完成 导致 version = 2 使得 正在执行的 A线程 操作修改失败</span></span><br><span class="line"><span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> name <span class="operator">=</span> &quot;kuangshen&quot;, version <span class="operator">=</span> version <span class="operator">+</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">where</span> id <span class="operator">=</span> <span class="number">2</span> <span class="keyword">and</span> version <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<blockquote>
<p><strong>MyBatis-Plus 乐观锁插件的具体使用步骤</strong></p>
</blockquote>
<ol>
<li><p>给数据库 相应表 user 添加 version 字段 并 同步实体类<br><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/252/image-20221013201701736.png" alt="image-20221013201701736"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Version</span>    <span class="comment">// 乐观锁 version 注解</span></span><br><span class="line"><span class="keyword">private</span> Integer version;</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写配置类 注册组件<br>&#x3D;&#x3D;TODO 测试 新版 乐观锁插件 使用方式&#x3D;&#x3D;<br>MyBatisPlusConfig</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mybatisplustest.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.OptimisticLockerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.EnableTransactionManagement;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 扫描 mapper 文件夹</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.example.mybatisplustest.mapper&quot;)</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span>    <span class="comment">// 显示的开启自动事务管理</span></span><br><span class="line"><span class="meta">@Configuration</span>  <span class="comment">// 注册 配置类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisPlusConfig</span> &#123;</span><br><span class="line">    <span class="comment">// 注册乐观锁插件</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> OptimisticLockerInterceptor <span class="title function_">optimisticLockerInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OptimisticLockerInterceptor</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>案例测试 乐观锁</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testOptimisticLocker</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 测试乐观锁 成功 update</span></span><br><span class="line">    <span class="comment">// 查询用户信息</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectById(<span class="number">1L</span>);</span><br><span class="line">    <span class="comment">// 设置用户信息</span></span><br><span class="line">    user.setName(<span class="string">&quot;Lixiaofeng&quot;</span>);</span><br><span class="line">    user.setEmail(<span class="string">&quot;33069987@asiainfo.com&quot;</span>);</span><br><span class="line">    <span class="comment">// 执行更新操作</span></span><br><span class="line">    userMapper.updateById(user);</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        执行结果 日志</span></span><br><span class="line"><span class="comment">        Creating a new SqlSession</span></span><br><span class="line"><span class="comment">        SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@1a1cc163] was not registered for synchronization because synchronization is not active</span></span><br><span class="line"><span class="comment">        JDBC Connection [HikariProxyConnection@1320809135 wrapping com.mysql.cj.jdbc.ConnectionImpl@4a481728] will not be managed by Spring</span></span><br><span class="line"><span class="comment">        ==&gt;  Preparing: SELECT id,name,age,email,version,create_time,update_time FROM user WHERE id=?</span></span><br><span class="line"><span class="comment">        ==&gt; Parameters: 1(Long)</span></span><br><span class="line"><span class="comment">        &lt;==    Columns: id, name, age, email, version, create_time, update_time</span></span><br><span class="line"><span class="comment">        &lt;==        Row: 1, Lixiaofeng, 18, 33069987@asiainfo.com, 1, 2022-10-12 22:28:33, 2022-10-13 09:13:19</span></span><br><span class="line"><span class="comment">        &lt;==      Total: 1</span></span><br><span class="line"><span class="comment">        Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@1a1cc163]</span></span><br><span class="line"><span class="comment">        Creating a new SqlSession</span></span><br><span class="line"><span class="comment">        SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@7327a447] was not registered for synchronization because synchronization is not active</span></span><br><span class="line"><span class="comment">        2022-10-13 09:17:39.634  INFO 19220 --- [           main] c.e.m.handler.MyMetaObjectHandler        : start update fill....</span></span><br><span class="line"><span class="comment">        JDBC Connection [HikariProxyConnection@876669389 wrapping com.mysql.cj.jdbc.ConnectionImpl@4a481728] will not be managed by Spring</span></span><br><span class="line"><span class="comment">        ==&gt;  Preparing: UPDATE user SET name=?, age=?, email=?, version=?, create_time=?, update_time=? WHERE id=? AND version=?</span></span><br><span class="line"><span class="comment">        ==&gt; Parameters: Lixiaofeng(String), 18(Integer), 33069987@asiainfo.com(String), 2(Integer), 2022-10-12 22:28:33.0(Timestamp), 2022-10-13 09:17:39.634(Timestamp), 1(Long), 1(Integer)</span></span><br><span class="line"><span class="comment">        &lt;==    Updates: 1</span></span><br><span class="line"><span class="comment">        Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@7327a447]</span></span><br><span class="line"><span class="comment">        可以清晰的看到 插件 帮我们在 update 的最后 添加了 AND version=? 同时 传入了值</span></span><br><span class="line"><span class="comment">        也可以看到 使用 MyBatis-Plus 做 Select 查询语句 会自动回显 到对象属性上</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testOptimisticLocker2</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 模拟乐观锁 处理多线程冲突</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 模拟线程 1</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectById(<span class="number">1L</span>);</span><br><span class="line">    user.setName(<span class="string">&quot;Lixiaofeng111&quot;</span>);</span><br><span class="line">    user.setEmail(<span class="string">&quot;33069987@asiainfo.com&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 模拟线程 2 执行插队操作</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> userMapper.selectById(<span class="number">1L</span>);</span><br><span class="line">    user2.setName(<span class="string">&quot;Lixiaofeng222&quot;</span>);</span><br><span class="line">    user2.setEmail(<span class="string">&quot;33069987@asiainfo.com&quot;</span>);</span><br><span class="line">    userMapper.updateById(user2);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果要使 这条 update 语句生效 需要使用 自旋锁 TODO</span></span><br><span class="line">    userMapper.updateById(user);   <span class="comment">// 如果没有 乐观锁 就会覆盖插队线程的值 所以此条语句 并不会执行出 update 效果 会被 乐观锁 拦截</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<blockquote>
<p><strong>Select</strong></p>
</blockquote>
<p><strong>参考代码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelect</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 测试查询</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectById(<span class="number">1L</span>);</span><br><span class="line">    System.out.println(user);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;-----------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试批量查询</span></span><br><span class="line">    List&lt;User&gt; userList = userMapper.selectBatchIds(Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>));</span><br><span class="line">    userList.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 简单条件查询 map操作</span></span><br><span class="line">    HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// 自定义查询条件</span></span><br><span class="line">    map.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;Jack&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;age&quot;</span>, <span class="number">20</span>);</span><br><span class="line">    List&lt;User&gt; userList2 = userMapper.selectByMap(map);</span><br><span class="line">    userList2.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<p><strong>分页查询</strong></p>
</blockquote>
<p>分页操作</p>
<ol>
<li>原始 limit 分页</li>
<li>pageHelper 第三方插件 实现分页</li>
<li>MyBatis-Plus 内置分页插件</li>
</ol>
<p><strong>MyBatis-Plus 内置分页插件使用步骤</strong></p>
<ol>
<li><p>配置分页组件拦截器<br>MyBatisPlusConfig</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mybatisplustest.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.OptimisticLockerInterceptor;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.PaginationInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.EnableTransactionManagement;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 扫描 mapper 文件夹</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.example.mybatisplustest.mapper&quot;)</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span>    <span class="comment">// 显示的开启自动事务管理</span></span><br><span class="line"><span class="meta">@Configuration</span>  <span class="comment">// 注册 配置类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisPlusConfig</span> &#123;</span><br><span class="line">    <span class="comment">// 注册乐观锁插件</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> OptimisticLockerInterceptor <span class="title function_">optimisticLockerInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OptimisticLockerInterceptor</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注册分页插件</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PaginationInterceptor <span class="title function_">paginationInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PaginationInterceptor</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试分页插件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPagination</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 测试分页查询</span></span><br><span class="line">    <span class="comment">// 参数: 1 --当前页  2 --一页展示数据条数</span></span><br><span class="line">    Page&lt;User&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(<span class="number">1</span>, <span class="number">5</span>);</span><br><span class="line">    userMapper.selectPage(page, <span class="literal">null</span>);</span><br><span class="line">    page.getRecords()</span><br><span class="line">        .forEach(System.out::println);</span><br><span class="line">    <span class="comment">// 使用分页 插件可以极大的简化 分页工作</span></span><br><span class="line">    <span class="comment">// TODO 学习 page类 的具体方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<blockquote>
<p><strong>Delete</strong></p>
</blockquote>
<p><strong>参考代码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDelete</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 测试删除</span></span><br><span class="line">    userMapper.deleteById(<span class="number">1580171623430950915L</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试通过 id 批量删除</span></span><br><span class="line">    userMapper.deleteBatchIds(Arrays.asList(<span class="number">1580171623430950913L</span>, <span class="number">1580171623430950914L</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试通过 map 删除</span></span><br><span class="line">    HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;ddd&quot;</span>);</span><br><span class="line">    <span class="comment">// TODO 在理解 自增id的问题 SQLyog 写入数据条目 id 后会被改变 故而研究 MyBatis-Plus 实现数据时 改变 ID 的流程时间</span></span><br><span class="line">    userMapper.deleteByMap(map);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>逻辑删除</strong></p>
<p>物理删除：使用 <code>delete</code> 从数据库中直接 移除</p>
<p>逻辑删除：并不会在数据库中直接移除 而是通过一个变量来控制其是否生效 <code>deleted = 0 -&gt; deleted = 1</code></p>
<p><em>实际应用 管理员可直接查看被删除的记录 使用逻辑删除可以防止数据丢失 类似于 回收站</em></p>
<p><strong>具体操作步骤及测试：</strong></p>
<ol>
<li><p>在数据库中增加 <code>deleted</code> 字段 并在 实体类上添加相应属性 同时添加逻辑删除注解<br><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/252/image-20221013110317209.png" alt="image-20221013110317209"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableLogic</span></span><br><span class="line"><span class="keyword">private</span> Integer deleted;</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置逻辑删除组件<br>MyBatisPlusConfig</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mybatisplustest.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.injector.ISqlInjector;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.injector.LogicSqlInjector;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.OptimisticLockerInterceptor;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.PaginationInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.EnableTransactionManagement;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 扫描 mapper 文件夹</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.example.mybatisplustest.mapper&quot;)</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span>    <span class="comment">// 显示的开启自动事务管理</span></span><br><span class="line"><span class="meta">@Configuration</span>  <span class="comment">// 注册 配置类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisPlusConfig</span> &#123;</span><br><span class="line">    <span class="comment">// 注册乐观锁插件</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> OptimisticLockerInterceptor <span class="title function_">optimisticLockerInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OptimisticLockerInterceptor</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注册分页插件</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PaginationInterceptor <span class="title function_">paginationInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PaginationInterceptor</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注册逻辑删除组件</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ISqlInjector <span class="title function_">iSqlInjector</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LogicSqlInjector</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写逻辑删除配置</p>
<p>application.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysql 5 与 mysql 8 驱动不相同 com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">123456</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/mybatis_plus?useSSL=false&amp;useUnicode=true&amp;characterEncoding=utf-8</span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># mysql 8 使用驱动 com.mysql.cj.jdbc.Driver 设置时区 serverTimezone=GMT%2B8</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 配置 mybatis-plus 日志</span></span><br><span class="line"><span class="attr">mybatis-plus.configuration.log-impl</span>=<span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 配置逻辑删除</span></span><br><span class="line"><span class="attr">mybatis-plus.global-config.db-config.logic-delete-value</span>=<span class="string">1</span></span><br><span class="line"><span class="attr">mybatis-plus.global-config.db-config.logic-not-delete-value</span>=<span class="string">0</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>测试配置好逻辑删除后的各种删除方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testLogicDelete</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 测试逻辑删除</span></span><br><span class="line">    userMapper.deleteById(<span class="number">1L</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试通过 id 批量逻辑删除</span></span><br><span class="line">    userMapper.deleteBatchIds(Arrays.asList(<span class="number">2L</span>, <span class="number">3L</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试通过 map 逻辑删除</span></span><br><span class="line">    HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;Billie&quot;</span>);</span><br><span class="line">    <span class="comment">// TODO 在理解 自增id的问题 SQLyog 写入数据条目 id 后会被改变 故而研究 MyBatis-Plus 实现数据时 改变 ID 的流程时间</span></span><br><span class="line">    userMapper.deleteByMap(map);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    执行结果日志</span></span><br><span class="line"><span class="comment">    Creating a new SqlSession</span></span><br><span class="line"><span class="comment">    SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@4eb9f2af] was not registered for synchronization because synchronization is not active</span></span><br><span class="line"><span class="comment">    JDBC Connection [HikariProxyConnection@268258490 wrapping com.mysql.cj.jdbc.ConnectionImpl@5f1483fd] will not be managed by Spring</span></span><br><span class="line"><span class="comment">    ==&gt;  Preparing: UPDATE user SET deleted=1 WHERE id=? AND deleted=0</span></span><br><span class="line"><span class="comment">    ==&gt; Parameters: 1(Long)</span></span><br><span class="line"><span class="comment">    &lt;==    Updates: 1</span></span><br><span class="line"><span class="comment">    Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@4eb9f2af]</span></span><br><span class="line"><span class="comment">    Creating a new SqlSession</span></span><br><span class="line"><span class="comment">    SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@65bad087] was not registered for synchronization because synchronization is not active</span></span><br><span class="line"><span class="comment">    JDBC Connection [HikariProxyConnection@1251133097 wrapping com.mysql.cj.jdbc.ConnectionImpl@5f1483fd] will not be managed by Spring</span></span><br><span class="line"><span class="comment">    ==&gt;  Preparing: UPDATE user SET deleted=1 WHERE id IN ( ? , ? ) AND deleted=0</span></span><br><span class="line"><span class="comment">    ==&gt; Parameters: 2(Long), 3(Long)</span></span><br><span class="line"><span class="comment">    &lt;==    Updates: 2</span></span><br><span class="line"><span class="comment">    Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@65bad087]</span></span><br><span class="line"><span class="comment">    Creating a new SqlSession</span></span><br><span class="line"><span class="comment">    SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@4cb702ce] was not registered for synchronization because synchronization is not active</span></span><br><span class="line"><span class="comment">    JDBC Connection [HikariProxyConnection@397639322 wrapping com.mysql.cj.jdbc.ConnectionImpl@5f1483fd] will not be managed by Spring</span></span><br><span class="line"><span class="comment">    ==&gt;  Preparing: UPDATE user SET deleted=1 WHERE name = ? AND deleted=0</span></span><br><span class="line"><span class="comment">    ==&gt; Parameters: Billie(String)</span></span><br><span class="line"><span class="comment">    &lt;==    Updates: 1</span></span><br><span class="line"><span class="comment">    Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@4cb702ce]</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    可以直观看出 虽然实际调用的是 delete 方法 但是在配置了逻辑删除后 实际上执行的是 update sql</span></span><br><span class="line"><span class="comment">    同时 配置逻辑查询后 再执行查询 会自动过滤被删除的字段 --MyBatis-Plus 的强大之处</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>执行查询测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 查询所有用户</span></span><br><span class="line">    <span class="comment">// 参数为 Wrapper --条件构造器 不使用 可为 null</span></span><br><span class="line">    List&lt;User&gt; userList = userMapper.selectList(<span class="literal">null</span>);</span><br><span class="line">    <span class="comment">//        Assert.isTrue();</span></span><br><span class="line">    userList.forEach(System.out::println);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    配置逻辑删除插件 逻辑删除后的 执行结果日志</span></span><br><span class="line"><span class="comment">    Creating a new SqlSession</span></span><br><span class="line"><span class="comment">    SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@76d72b5b] was not registered for synchronization because synchronization is not active</span></span><br><span class="line"><span class="comment">    JDBC Connection [HikariProxyConnection@1719727892 wrapping com.mysql.cj.jdbc.ConnectionImpl@53b1a3f8] will not be managed by Spring</span></span><br><span class="line"><span class="comment">    ==&gt;  Preparing: SELECT id,name,age,email,version,create_time,update_time,deleted FROM user WHERE deleted=0 </span></span><br><span class="line"><span class="comment">    ==&gt; Parameters: </span></span><br><span class="line"><span class="comment">    &lt;==    Columns: id, name, age, email, version, create_time, update_time, deleted</span></span><br><span class="line"><span class="comment">    &lt;==        Row: 4, Sandy, 21, test4@baomidou.com, 1, 2022-10-12 22:28:33, 2022-10-12 22:28:33, 0</span></span><br><span class="line"><span class="comment">    &lt;==        Row: 6, kaungshen, 12, 983443816@qq.com, 1, 2022-10-12 22:28:33, 2022-10-12 22:28:33, 0</span></span><br><span class="line"><span class="comment">    &lt;==      Total: 2</span></span><br><span class="line"><span class="comment">    Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@76d72b5b]</span></span><br><span class="line"><span class="comment">    User(id=4, name=Sandy, age=21, email=test4@baomidou.com, version=1, createTime=Wed Oct 12 22:28:33 CST 2022, updateTime=Wed Oct 12 22:28:33 CST 2022, deleted=0)</span></span><br><span class="line"><span class="comment">    User(id=6, name=kaungshen, age=12, email=983443816@qq.com, version=1, createTime=Wed Oct 12 22:28:33 CST 2022, updateTime=Wed Oct 12 22:28:33 CST 2022, deleted=0)</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    自动拼接匹配逻辑删除</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="5-性能分析插件"><a href="#5-性能分析插件" class="headerlink" title="5. 性能分析插件"></a>5. 性能分析插件</h2><p> 常规开发中 经常会遇到一些 <strong>慢SQL</strong> 通过 测试 压测工具 Druid …. 方式 进行查询并优化</p>
<p>处理此类情况 MyBatis-Plus 同样提供 性能分析 插件 当执行 SQL 时间超过这个 规定时间 就会强行停止运行</p>
<p>作用：性能分析拦截器 用于输出 每条 SQL 语句的执行时间</p>
<p><strong>具体操作步骤</strong></p>
<ol>
<li><p>配置性能分析组件 的配置类<br>MyBatisPlusConfig</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mybatisplustest.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.injector.ISqlInjector;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.injector.LogicSqlInjector;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.OptimisticLockerInterceptor;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.PaginationInterceptor;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.PerformanceInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Profile;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.EnableTransactionManagement;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 扫描 mapper 文件夹</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.example.mybatisplustest.mapper&quot;)</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span>    <span class="comment">// 显示的开启自动事务管理</span></span><br><span class="line"><span class="meta">@Configuration</span>  <span class="comment">// 注册 配置类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisPlusConfig</span> &#123;</span><br><span class="line">    <span class="comment">// 注册乐观锁插件</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> OptimisticLockerInterceptor <span class="title function_">optimisticLockerInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OptimisticLockerInterceptor</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注册分页插件</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PaginationInterceptor <span class="title function_">paginationInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PaginationInterceptor</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注册逻辑删除组件</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ISqlInjector <span class="title function_">iSqlInjector</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LogicSqlInjector</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// SQL 执行效率插件</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Profile(&#123;&quot;dev&quot;, &quot;test&quot;&#125;)</span>   <span class="comment">// 设置 仅在 dev test 环境下开启 --保证正常上线时 没有多余的性能损耗</span></span><br><span class="line">    <span class="keyword">public</span> PerformanceInterceptor <span class="title function_">performanceInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PerformanceInterceptor</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置开发环境</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置开发环境</span></span><br><span class="line"><span class="attr">spring.profiles.active</span>=<span class="string">dev</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># mysql 5 与 mysql 8 驱动不相同 com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">123456</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/mybatis_plus?useSSL=false&amp;useUnicode=true&amp;characterEncoding=utf-8</span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># mysql 8 使用驱动 com.mysql.cj.jdbc.Driver 设置时区 serverTimezone=GMT%2B8</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 配置 mybatis-plus 日志</span></span><br><span class="line"><span class="attr">mybatis-plus.configuration.log-impl</span>=<span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 配置逻辑删除</span></span><br><span class="line"><span class="attr">mybatis-plus.global-config.db-config.logic-delete-value</span>=<span class="string">1</span></span><br><span class="line"><span class="attr">mybatis-plus.global-config.db-config.logic-not-delete-value</span>=<span class="string">测试性能使用</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置 SQL 执行效率插件 参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SQL 执行效率插件</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Profile(&#123;&quot;dev&quot;, &quot;test&quot;&#125;)</span>   <span class="comment">// 设置 仅在 dev test 环境下开启 --保证正常上线时 没有多余的性能损耗</span></span><br><span class="line"><span class="keyword">public</span> PerformanceInterceptor <span class="title function_">performanceInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">PerformanceInterceptor</span> <span class="variable">performanceInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PerformanceInterceptor</span>();</span><br><span class="line">    performanceInterceptor.setMaxTime(<span class="number">1</span>);   <span class="comment">// ms 设置 SQL 最大执行时间 如果超时 则不执行</span></span><br><span class="line">    performanceInterceptor.setFormat(<span class="literal">true</span>); <span class="comment">// 是否开启 格式化支持</span></span><br><span class="line">    <span class="keyword">return</span> performanceInterceptor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试 查询等 SQL 语句</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 查询所有用户</span></span><br><span class="line">    <span class="comment">// 参数为 Wrapper --条件构造器 不使用 可为 null</span></span><br><span class="line">    List&lt;User&gt; userList = userMapper.selectList(<span class="literal">null</span>);</span><br><span class="line">    <span class="comment">//        Assert.isTrue();</span></span><br><span class="line">    userList.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    配置 SQL 性能检测后 的执行结果日志</span></span><br><span class="line"><span class="comment">    Creating a new SqlSession</span></span><br><span class="line"><span class="comment">    SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@7c37f145] was not registered for synchronization because synchronization is not active</span></span><br><span class="line"><span class="comment">    JDBC Connection [HikariProxyConnection@1955226954 wrapping com.mysql.cj.jdbc.ConnectionImpl@1d8b0500] will not be managed by Spring</span></span><br><span class="line"><span class="comment">    ==&gt;  Preparing: SELECT id,name,age,email,version,create_time,update_time,deleted FROM user WHERE deleted=0</span></span><br><span class="line"><span class="comment">    ==&gt; Parameters:</span></span><br><span class="line"><span class="comment">    &lt;==    Columns: id, name, age, email, version, create_time, update_time, deleted</span></span><br><span class="line"><span class="comment">    &lt;==        Row: 4, Sandy, 21, test4@baomidou.com, 1, 2022-10-12 22:28:33, 2022-10-12 22:28:33, 0</span></span><br><span class="line"><span class="comment">    &lt;==        Row: 6, kaungshen, 12, 983443816@qq.com, 1, 2022-10-12 22:28:33, 2022-10-12 22:28:33, 0</span></span><br><span class="line"><span class="comment">    &lt;==      Total: 2</span></span><br><span class="line"><span class="comment">     Time：16 ms - ID：com.example.mybatisplustest.mapper.UserMapper.selectList</span></span><br><span class="line"><span class="comment">    Execute SQL：</span></span><br><span class="line"><span class="comment">        SELECT</span></span><br><span class="line"><span class="comment">            id,</span></span><br><span class="line"><span class="comment">            name,</span></span><br><span class="line"><span class="comment">            age,</span></span><br><span class="line"><span class="comment">            email,</span></span><br><span class="line"><span class="comment">            version,</span></span><br><span class="line"><span class="comment">            create_time,</span></span><br><span class="line"><span class="comment">            update_time,</span></span><br><span class="line"><span class="comment">            deleted</span></span><br><span class="line"><span class="comment">        FROM</span></span><br><span class="line"><span class="comment">            user</span></span><br><span class="line"><span class="comment">        WHERE</span></span><br><span class="line"><span class="comment">            deleted=0</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@7c37f145]</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    org.mybatis.spring.MyBatisSystemException: nested exception is org.apache.ibatis.exceptions.PersistenceException:</span></span><br><span class="line"><span class="comment">    ### Error querying database.  Cause: com.baomidou.mybatisplus.core.exceptions.MybatisPlusException:  The SQL execution time is too large, please optimize !</span></span><br><span class="line"><span class="comment">    ### The error may exist in com/example/mybatisplustest/mapper/UserMapper.java (best guess)</span></span><br><span class="line"><span class="comment">    ### The error may involve com.example.mybatisplustest.mapper.UserMapper.selectList</span></span><br><span class="line"><span class="comment">    ### The error occurred while handling results</span></span><br><span class="line"><span class="comment">    ### SQL: SELECT  id,name,age,email,version,create_time,update_time,deleted  FROM user  WHERE  deleted=0</span></span><br><span class="line"><span class="comment">    ### Cause: com.baomidou.mybatisplus.core.exceptions.MybatisPlusException:  The SQL execution time is too large, please optimize !</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    Caused by: org.apache.ibatis.exceptions.PersistenceException:</span></span><br><span class="line"><span class="comment">    ### Error querying database.  Cause: com.baomidou.mybatisplus.core.exceptions.MybatisPlusException:  The SQL execution time is too large, please optimize !</span></span><br><span class="line"><span class="comment">    ### The error may exist in com/example/mybatisplustest/mapper/UserMapper.java (best guess)</span></span><br><span class="line"><span class="comment">    ### The error may involve com.example.mybatisplustest.mapper.UserMapper.selectList</span></span><br><span class="line"><span class="comment">    ### The error occurred while handling results</span></span><br><span class="line"><span class="comment">    ### SQL: SELECT  id,name,age,email,version,create_time,update_time,deleted  FROM user  WHERE  deleted=0</span></span><br><span class="line"><span class="comment">    ### Cause: com.baomidou.mybatisplus.core.exceptions.MybatisPlusException:  The SQL execution time is too large, please optimize !</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    可以清晰看到 格式化 后的 SQL 语句 以及对比 SQL 执行的时间</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>&#x3D;&#x3D;使用性能分析插件能很好的规避 慢SQL 分析效率问题&#x3D;&#x3D;</p>
<h2 id="6-条件构造器"><a href="#6-条件构造器" class="headerlink" title="6. 条件构造器"></a>6. 条件构造器</h2><p><em>主要用于高级条件操作 代替 SQL 语句中的繁琐条件规则</em></p>
<p><em>大型企业中的 Git 都是内部化 非公开的 通常是 购买或者内部搭建的</em></p>
<p><strong>参考代码：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testWrapper</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 需求 查询 name 不为空 Email 不为空 age 大于 18 的用户</span></span><br><span class="line">    QueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// 对比 map 学习</span></span><br><span class="line">    wrapper.isNotNull(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">        .isNotNull(<span class="string">&quot;email&quot;</span>)</span><br><span class="line">        .ge(<span class="string">&quot;age&quot;</span>, <span class="number">18</span>);</span><br><span class="line"></span><br><span class="line">    userMapper.selectList(wrapper).forEach(System.out::println);</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    查询结果日志</span></span><br><span class="line"><span class="comment">    Creating a new SqlSession</span></span><br><span class="line"><span class="comment">    SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@631cb129] was not registered for synchronization because synchronization is not active</span></span><br><span class="line"><span class="comment">    JDBC Connection [HikariProxyConnection@1878045132 wrapping com.mysql.cj.jdbc.ConnectionImpl@3b55dd15] will not be managed by Spring</span></span><br><span class="line"><span class="comment">    ==&gt;  Preparing: SELECT id,name,age,email,version,create_time,update_time,deleted FROM user WHERE deleted=0 AND name IS NOT NULL AND email IS NOT NULL AND age &gt;= ? </span></span><br><span class="line"><span class="comment">    ==&gt; Parameters: 18(Integer)</span></span><br><span class="line"><span class="comment">    &lt;==    Columns: id, name, age, email, version, create_time, update_time, deleted</span></span><br><span class="line"><span class="comment">    &lt;==        Row: 4, Sandy, 21, test4@baomidou.com, 1, 2022-10-12 22:28:33, 2022-10-12 22:28:33, 0</span></span><br><span class="line"><span class="comment">    &lt;==        Row: 15801716234310, Liyang, 28, 1031222691@qq.com, 1, 2022-10-13 11:57:01, 2022-10-13 11:57:01, 0</span></span><br><span class="line"><span class="comment">    &lt;==        Row: 15801716234311, Lizhengzuo, 38, 1031222691@qq.com, 1, 2022-10-13 11:57:17, 2022-10-13 11:57:17, 0</span></span><br><span class="line"><span class="comment">    &lt;==      Total: 3</span></span><br><span class="line"><span class="comment">     Time：14 ms - ID：com.example.mybatisplustest.mapper.UserMapper.selectList</span></span><br><span class="line"><span class="comment">    Execute SQL：</span></span><br><span class="line"><span class="comment">        SELECT</span></span><br><span class="line"><span class="comment">            id,</span></span><br><span class="line"><span class="comment">            name,</span></span><br><span class="line"><span class="comment">            age,</span></span><br><span class="line"><span class="comment">            email,</span></span><br><span class="line"><span class="comment">            version,</span></span><br><span class="line"><span class="comment">            create_time,</span></span><br><span class="line"><span class="comment">            update_time,</span></span><br><span class="line"><span class="comment">            deleted </span></span><br><span class="line"><span class="comment">        FROM</span></span><br><span class="line"><span class="comment">            user </span></span><br><span class="line"><span class="comment">        WHERE</span></span><br><span class="line"><span class="comment">            deleted=0 </span></span><br><span class="line"><span class="comment">            AND name IS NOT NULL </span></span><br><span class="line"><span class="comment">            AND email IS NOT NULL </span></span><br><span class="line"><span class="comment">            AND age &gt;= 18</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@631cb129]</span></span><br><span class="line"><span class="comment">    User(id=4, name=Sandy, age=21, email=test4@baomidou.com, version=1, createTime=Wed Oct 12 22:28:33 CST 2022, updateTime=Wed Oct 12 22:28:33 CST 2022, deleted=0)</span></span><br><span class="line"><span class="comment">    User(id=15801716234310, name=Liyang, age=28, email=1031222691@qq.com, version=1, createTime=Thu Oct 13 11:57:01 CST 2022, updateTime=Thu Oct 13 11:57:01 CST 2022, deleted=0)</span></span><br><span class="line"><span class="comment">    User(id=15801716234311, name=Lizhengzuo, age=38, email=1031222691@qq.com, version=1, createTime=Thu Oct 13 11:57:17 CST 2022, updateTime=Thu Oct 13 11:57:17 CST 2022, deleted=0)</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testWrapper2</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 根据 name 查询</span></span><br><span class="line">    QueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    wrapper.eq(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;yupi&quot;</span>);</span><br><span class="line">    <span class="comment">// 查询一个数据</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectOne(wrapper);</span><br><span class="line">    System.out.println(user);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;----------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询 age 在 20 - 30 之间的用户</span></span><br><span class="line">    QueryWrapper&lt;User&gt; wrapper2 = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    wrapper2.between(<span class="string">&quot;age&quot;</span>, <span class="number">20</span>, <span class="number">30</span>);</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> userMapper.selectCount(wrapper2);<span class="comment">// 查询结果计数</span></span><br><span class="line">    System.out.println(count);</span><br><span class="line">    userMapper.selectList(wrapper2).forEach(System.out::println);<span class="comment">// 查询结果</span></span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;----------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 模糊查询</span></span><br><span class="line">    QueryWrapper&lt;User&gt; wrapper3 = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    wrapper3.notLike(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;L&quot;</span>)</span><br><span class="line">        .likeRight(<span class="string">&quot;email&quot;</span>, <span class="string">&quot;t&quot;</span>);</span><br><span class="line">    List&lt;Map&lt;String, Object&gt;&gt; maps = userMapper.selectMaps(wrapper3);</span><br><span class="line">    <span class="comment">// Map中 结果如何排序问题</span></span><br><span class="line">    maps.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;-----------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 子查询</span></span><br><span class="line">    QueryWrapper&lt;User&gt; wrapper4 = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// id 在子查询中</span></span><br><span class="line">    wrapper4.inSql(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;select id from user where id &lt; 3&quot;</span>);</span><br><span class="line"></span><br><span class="line">    userMapper.selectObjs(wrapper4).forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;-----------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">    QueryWrapper&lt;User&gt; wrapper5 = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// 通过 id 进行排序</span></span><br><span class="line">    wrapper5.orderByDesc(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">    userMapper.selectList(wrapper5).forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>大学学人傻了 Spring + Struts +Hibernate (全自动 不支持定制化 国外使用较多)</em></p>
<h2 id="7-代码生成器"><a href="#7-代码生成器" class="headerlink" title="7. 代码生成器"></a>7. 代码生成器</h2><p><strong>参考代码</strong></p>
<p>LinCode</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mybatisplustest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.DbType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.FieldFill;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.IdType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.DataSourceConfig;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.GlobalConfig;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.AutoGenerator;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.PackageConfig;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.StrategyConfig;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.po.TableFill;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.rules.DateType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.rules.NamingStrategy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代码 自动生成器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinCode</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 需要构建一个 代码自动生成器 对象</span></span><br><span class="line">        <span class="type">AutoGenerator</span> <span class="variable">mpg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AutoGenerator</span>();</span><br><span class="line">        <span class="comment">// 配置策略</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. 全局配置</span></span><br><span class="line">        <span class="type">GlobalConfig</span> <span class="variable">gc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GlobalConfig</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">projectPath</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;user.dir&quot;</span>);</span><br><span class="line">        gc.setOutputDir(projectPath + <span class="string">&quot;/src/main/java&quot;</span>);</span><br><span class="line">        gc.setAuthor(<span class="string">&quot;Liny&quot;</span>);</span><br><span class="line">        gc.setOpen(<span class="literal">false</span>);</span><br><span class="line">        gc.setFileOverride(<span class="literal">false</span>);  <span class="comment">// 是否覆盖</span></span><br><span class="line">        gc.setServiceName(<span class="string">&quot;%sService&quot;</span>); <span class="comment">//去 Service 的 I 前缀</span></span><br><span class="line">        gc.setIdType(IdType.ID_WORKER);</span><br><span class="line">        gc.setDateType(DateType.ONLY_DATE);</span><br><span class="line">        gc.setSwagger2(<span class="literal">true</span>);</span><br><span class="line">        mpg.setGlobalConfig(gc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 设置数据源</span></span><br><span class="line">        <span class="type">DataSourceConfig</span> <span class="variable">dsc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataSourceConfig</span>();</span><br><span class="line">        dsc.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/mybatis_plus?useSSL=false&amp;useUnicode=true&amp;characterEncoding=utf-8&quot;</span>);</span><br><span class="line">        dsc.setDriverName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        dsc.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dsc.setPassword(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        dsc.setDbType(DbType.MYSQL);</span><br><span class="line">        mpg.setDataSource(dsc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. 包配置</span></span><br><span class="line">        <span class="type">PackageConfig</span> <span class="variable">pc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PackageConfig</span>();</span><br><span class="line">        pc.setModuleName(<span class="string">&quot;blog&quot;</span>);</span><br><span class="line">        pc.setParent(<span class="string">&quot;com.lin&quot;</span>);</span><br><span class="line">        pc.setEntity(<span class="string">&quot;entity&quot;</span>);</span><br><span class="line">        pc.setMapper(<span class="string">&quot;mapper&quot;</span>);</span><br><span class="line">        pc.setService(<span class="string">&quot;service&quot;</span>);</span><br><span class="line">        pc.setController(<span class="string">&quot;controller&quot;</span>);</span><br><span class="line">        mpg.setPackageInfo(pc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. 策略配置</span></span><br><span class="line">        <span class="type">StrategyConfig</span> <span class="variable">strategy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StrategyConfig</span>();</span><br><span class="line">        strategy.setInclude(<span class="string">&quot;user&quot;</span>);    <span class="comment">// 设置需要映射的表名</span></span><br><span class="line">        strategy.setNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        strategy.setColumnNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        strategy.setSuperEntityClass(<span class="string">&quot;自己的父类实体 没有就不用设置&quot;</span>);</span><br><span class="line">        strategy.setEntityLombokModel(<span class="literal">true</span>);    <span class="comment">// 自动lombok</span></span><br><span class="line"><span class="comment">//        strategy.setRestControllerStyle(true);    // RestFul Controller</span></span><br><span class="line">        strategy.setLogicDeleteFieldName(<span class="string">&quot;deleted&quot;</span>);    <span class="comment">// 配置逻辑删除</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 自动填充配置</span></span><br><span class="line">        <span class="type">TableFill</span> <span class="variable">gmtCreate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TableFill</span>(<span class="string">&quot;gmt_create&quot;</span>, FieldFill.INSERT);</span><br><span class="line">        <span class="type">TableFill</span> <span class="variable">gmtModified</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TableFill</span>(<span class="string">&quot;gmt_modified&quot;</span>, FieldFill.INSERT_UPDATE);</span><br><span class="line">        ArrayList&lt;TableFill&gt; tableFills = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        tableFills.add(gmtCreate);</span><br><span class="line">        tableFills.add(gmtModified);</span><br><span class="line">        strategy.setTableFillList(tableFills);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 乐观锁</span></span><br><span class="line">        strategy.setVersionFieldName(<span class="string">&quot;version&quot;</span>);</span><br><span class="line">        strategy.setRestControllerStyle(<span class="literal">true</span>);</span><br><span class="line">        strategy.setControllerMappingHyphenStyle(<span class="literal">true</span>); <span class="comment">// localhost:8080/hello_id_2 使用下划线命名</span></span><br><span class="line">        mpg.setStrategy(strategy);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 执行</span></span><br><span class="line">        mpg.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:  </strong>Linyuxuan
  </li>
  <li class="post-copyright-link">
    <strong>Post link: </strong>
    <a href="https://negativefunction.github.io/2023/01/21/Mybatis-plus/" title="Mybatis-plus">https://negativefunction.github.io/2023/01/21/Mybatis-plus/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>


      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2023/01/21/DataStructure/" rel="prev" title="DataStructureAlgorithm">
      <i class="fa fa-chevron-left"></i> DataStructureAlgorithm
    </a></div>
      <div class="post-nav-item">
    <a href="/2023/01/21/JUC/" rel="next" title="JUC">
      JUC <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#MyBatisPlus-Note"><span class="nav-number">1.</span> <span class="nav-text">MyBatisPlus_Note</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-MyBatisPlus%E6%A6%82%E8%BF%B0"><span class="nav-number">1.1.</span> <span class="nav-text">1. MyBatisPlus概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="nav-number">1.2.</span> <span class="nav-text">2. 快速入门</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E9%85%8D%E7%BD%AE%E6%97%A5%E5%BF%97"><span class="nav-number">1.3.</span> <span class="nav-text">3. 配置日志</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E7%AE%80%E5%8D%95-CRUD-%E6%93%8D%E4%BD%9C%E8%AF%A6%E8%A7%A3"><span class="nav-number">1.4.</span> <span class="nav-text">4. 简单 CRUD 操作详解</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E6%8F%92%E4%BB%B6"><span class="nav-number">1.5.</span> <span class="nav-text">5. 性能分析插件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-%E6%9D%A1%E4%BB%B6%E6%9E%84%E9%80%A0%E5%99%A8"><span class="nav-number">1.6.</span> <span class="nav-text">6. 条件构造器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E5%99%A8"><span class="nav-number">1.7.</span> <span class="nav-text">7. 代码生成器</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Linyuxuan"
      src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/252/05.jpg">
  <p class="site-author-name" itemprop="name">Linyuxuan</p>
  <div class="site-description" itemprop="description">Hope Sometimes Love Brain</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">17</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2020 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa-gift"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Linyuxuan</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/pjax/pjax.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  















    <div id="pjax">
  

  

    </div>
</body>
</html>
